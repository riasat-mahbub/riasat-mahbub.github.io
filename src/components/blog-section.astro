---
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const latestPosts = posts
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .slice(0, 4);

function truncateTitle(title: string, maxLength: number = 60) {
  return title.length > maxLength ? title.substring(0, maxLength) + '...' : title;
}
---

<section class="py-12 border-t border-[#ffffff10] text-[var(--white)] max-w-5xl mx-auto my-10 px-4 sm:px-6 lg:px-0" id="blog">
  <div class="max-w-5xl mx-auto">
    <h2 class="text-lg text-[var(--sec)] mb-2 shiny-sec">Latest Posts</h2>
    <h3 class="text-4xl md:text-5xl font-medium mb-10">
      Blog
    </h3>

    {latestPosts.length > 0 ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 md:gap-8">
        {latestPosts.map((post) => (
          <a
            href={`/blog/${post.slug}`}
            class="group"
          >
            <div
              class="flex flex-col justify-between h-full rounded-2xl shadow-lg bg-[#1414149c]
                    p-5 sm:p-6 transition-all duration-300 
                    hover:shadow-xl hover:scale-[1.03] hover:bg-[#1c1c1c]"
            >
              <div>
                <div class="flex items-center gap-2 mb-3">
                  <span class={`px-2 py-1 rounded text-xs font-medium ${
                    post.data.difficulty === 'Easy' ? 'bg-green-500 text-white' :
                    post.data.difficulty === 'Medium' ? 'bg-yellow-500 text-white' : 'bg-red-500 text-white'
                  }`}>
                    {post.data.difficulty}
                  </span>
                  <span class="text-xs text-[var(--white-icon)]">
                    {post.data.publishDate.toLocaleDateString()}
                  </span>
                </div>
                <h4 class="text-xl sm:text-2xl font-semibold mb-2 leading-snug">
                  {truncateTitle(post.data.title)}
                </h4>
                <p class="text-sm sm:text-base text-[var(--white-icon)] leading-relaxed mb-3">
                  {post.data.description}
                </p>
                <div class="flex flex-wrap gap-1">
                  {post.data.tags.slice(0, 2).map(tag => (
                    <span class="px-2 py-1 bg-[var(--white-icon-tr)] text-[var(--white-icon)] rounded text-xs">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>

              <div
                class="self-end mt-6 size-12 sm:size-14 flex justify-center items-center 
                      text-[var(--white-icon)] hover:text-white transition duration-300 ease-in-out 
                      border border-[var(--white-icon-tr)] p-3 rounded-xl 
                      bg-[#1414149c] hover:bg-[var(--white-icon-tr)]"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  class="size-6 sm:size-7"
                >
                  <path d="M16.0037 9.41421L7.39712 18.0208L5.98291 16.6066L14.5895 8H7.00373V6H18.0037V17H16.0037V9.41421Z" />
                </svg>
              </div>
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="text-center py-12">
        <p class="text-[var(--white-icon)]">Coming soon... Currently working on LeetCode solutions!</p>
      </div>
    )}
  </div>

  <a
    href="/blog"
    class="w-full max-w-5xl mx-auto flex items-center justify-center gap-2 mt-9 text-[var(--white-icon)] dark:hover:text-white hover:text-black transition duration-300 ease-in-out border border-[var(--white-icon-tr)] p-3 rounded-full bg-[#1414149c] hover:bg-[var(--white-icon-tr)] hover:scale-105"
  >
    <span class="md:text-lg text-md">Read more posts</span>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="currentColor"
      class="size-6"
    >
      <path d="M16.0037 9.41421L7.39712 18.0208L5.98291 16.6066L14.5895 8H7.00373V6H18.0037V17H16.0037V9.41421Z" />
    </svg>
  </a>
</section>